import{useRef as e,useState as t,useEffect as o,useCallback as l}from"react";import r from"@use-it/event-listener";const a={},n=(e,t,o)=>(a[e]||(a[e]={callbacks:[],value:o}),a[e].callbacks.push(t),{deregister(){const o=a[e].callbacks,l=o.indexOf(t);l>-1&&o.splice(l,1)},emit(o){a[e].value!==o&&(a[e].value=o,a[e].callbacks.forEach(e=>{t!==e&&e(o)}))}});export default(a,c=(()=>"undefined"!=typeof global&&global.localStorage?global.localStorage:"undefined"!=typeof globalThis&&globalThis.localStorage?globalThis.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:"undefined"!=typeof localStorage?localStorage:null)())=>{if(c){const s=(e=>({get(t,o){const l=e.getItem(t),r="function"==typeof o?o():o;try{return null==l?r:JSON.parse(l)}catch(e){return console.error(e),r}},set(t,o){e.setItem(t,JSON.stringify(o))}}))(c);return c=>((a,c,{get:s,set:i})=>{const u=e(null),[g,f]=t(()=>s(c,a));r("storage",({key:e,newValue:t})=>{if(e===c){const e=JSON.parse(t);g!==e&&f(e)}}),o(()=>(u.current=n(c,f,a),()=>{u.current.deregister()}),[a,c]);const d=l(e=>{const t="function"==typeof e?e(g):e;i(c,t),f(t),u.current.emit(e)},[g,i,c]);return[g,d]})(c,a,s)}return t};
