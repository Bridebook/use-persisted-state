import{useRef as e,useState as t,useEffect as n,useCallback as r}from"react";import o from"@use-it/event-listener";var l={},a=function(e,t,n){return l[e]||(l[e]={callbacks:[],value:n}),l[e].callbacks.push(t),{deregister:function(){var n=l[e].callbacks,r=n.indexOf(t);r>-1&&n.splice(r,1)},emit:function(n){l[e].value!==n&&(l[e].value=n,l[e].callbacks.forEach(function(e){t!==e&&e(n)}))}}};export default function(l,u){if(void 0===u&&(u="undefined"!=typeof global&&global.localStorage?global.localStorage:"undefined"!=typeof globalThis&&globalThis.localStorage?globalThis.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:"undefined"!=typeof localStorage?localStorage:null),u){var c=function(e){return{get:function(t,n){var r=e.getItem(t),o="function"==typeof n?n():n;try{return null==r?o:JSON.parse(r)}catch(e){return console.error(e),o}},set:function(t,n){e.setItem(t,JSON.stringify(n))}}}(u);return function(u){return function(l,u,c){var i=c.get,f=c.set,g=e(null),s=t(function(){return i(u,l)}),d=s[0],p=s[1];o("storage",function(e){if(e.key===u){var t=JSON.parse(e.newValue);d!==t&&p(t)}}),n(function(){return g.current=a(u,p,l),function(){g.current.deregister()}},[l,u]);var v=r(function(e){var t="function"==typeof e?e(d):e;f(u,t),p(t),g.current.emit(e)},[d,f,u]);return[d,v]}(u,l,c)}}return t}
