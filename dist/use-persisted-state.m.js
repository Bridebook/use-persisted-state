import{useState as t,useEffect as n,useRef as r,useCallback as e}from"react";import u from"@use-it/event-listener";var c={},o=function(t,n,r){return c[t]||(c[t]={callbacks:[],value:r}),c[t].callbacks.push(n),{deregister:function(){var r=c[t].callbacks,e=r.indexOf(n);e>-1&&r.splice(e,1)},emit:function(r){c[t].value!==r&&(c[t].value=r,c[t].callbacks.forEach(function(t){n!==t&&t(r)}))}}};export default function(c,i){if(void 0===i&&(i=global.localStorage),i){var a=function(t){return{get:function(n,r){var e=t.getItem(n),u="function"==typeof r?r():r;try{return null==e?u:JSON.parse(e)}catch(t){return console.error(t),u}},set:function(n,r){t.setItem(n,JSON.stringify(r))}}}(i);return function(i){return function(c,i,a){var f=a.get,l=a.set,s=r(null),v=t(function(){return f(i,c)}),g=v[0],p=v[1];u("storage",function(t){if(t.key===i){var n=JSON.parse(t.newValue);g!==n&&p(n)}}),n(function(){return s.current=o(i,p,c),function(){s.current.deregister()}},[]);var m=e(function(t){var n="function"==typeof t?t(g):t;l(i,t),p(n),s.current.emit(t)},[g,l,i]);return[g,m]}(i,c,a)}}return t}
